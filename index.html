<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ™ºèƒ½å•è¯ç®¡ç†å™¨</title>
    <link href="https://cdn.bootcdn.net/ajax/libs/twitter-bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css" rel="stylesheet">
    <style>
        :root {
            --primary: #6c5ce7;
            --secondary: #4a90e2;
            --success: #00b894;
            --danger: #ff7675;
            --dark-bg: #2d3436;
            --light-bg: #f8f9fa;
        }

        body {
            background: linear-gradient(135deg, var(--light-bg) 0%, #dfe6e9 100%);
            min-height: 100vh;
            padding: 2rem;
            transition: background 0.3s ease;
        }

        body.dark-mode {
            background: linear-gradient(135deg, var(--dark-bg) 0%, #2d3436 100%);
            color: #fff;
        }

        .glass-container {
            background: rgba(255, 255, 255, 0.9);
            backdrop-filter: blur(12px);
            border-radius: 20px;
            box-shadow: 0 12px 40px rgba(0,0,0,0.1);
            padding: 2rem;
            margin-bottom: 2rem;
            transition: all 0.3s ease;
        }

        .dark-mode .glass-container {
            background: rgba(45, 52, 54, 0.9);
            box-shadow: 0 12px 40px rgba(0,0,0,0.3);
        }

        .neon-button {
            background: var(--primary);
            border: 2px solid var(--primary);
            color: white;
            padding: 12px 30px;
            border-radius: 30px;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .neon-button::before {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            width: 0;
            height: 0;
            background: rgba(255,255,255,0.2);
            border-radius: 50%;
            transition: width 0.3s, height 0.3s;
        }

        .neon-button:hover {
            box-shadow: 0 0 20px var(--primary);
            transform: translateY(-2px);
        }

        .neon-button:hover::before {
            width: 200px;
            height: 200px;
        }

        .table {
            --bs-table-bg: transparent;
            --bs-table-striped-bg: rgba(108, 92, 231, 0.05);
        }

        .dark-mode .table {
            color: #fff;
            --bs-table-striped-bg: rgba(255,255,255,0.05);
        }

        .floating-controls {
            position: fixed;
            bottom: 30px;
            right: 30px;
            display: flex;
            gap: 15px;
            z-index: 1000;
        }

        .theme-switch {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            background: var(--primary);
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
        }

        .word-count-badge {
            position: absolute;
            top: -10px;
            right: -10px;
            background: var(--danger);
            color: white;
            border-radius: 20px;
            padding: 5px 12px;
            font-size: 0.8rem;
        }

        @media (max-width: 768px) {
            body {
                padding: 1rem;
            }

            .input-group {
                width:15rem;
                margin-bottom: 12px;
            }
            .neon-button {
                width: 100%;
                margin-bottom: 1rem;
            }
        }
    </style>
</head>
<body>
    <!-- æ‚¬æµ®æ§åˆ¶æŒ‰é’® -->
    <div class="floating-controls">
        <div class="theme-switch" onclick="toggleDarkMode()">
            ğŸŒ“
        </div>
    </div>

    <!-- è®¾ç½®é¢æ¿ -->
    <div class="glass-container setting-panel animate__animated" id="settingsPanel">
        <h3>ğŸ“– èƒŒè¯µè®¾ç½®</h3>
        <div class="row g-3">
            <div class="col-md-6">
                <label>æ¨¡å¼é€‰æ‹©</label>
                <select id="recitationMode" class="form-select">
                    <option value="1">é¡ºåºæ¨¡å¼</option>
                    <option value="2">éšæœºæ¨¡å¼</option>
                    <option value="3">å›°éš¾ä¼˜å…ˆ</option>
                </select>
            </div>
            <div class="col-md-6">
                <label>èƒŒè¯µæ•°é‡</label>
                <input type="range" id="recitationCount" class="form-range" min="5" max="50" value="20">
                <span id="countDisplay">20 ä¸ª</span>
            </div>
        </div>
        <div class="mt-3 d-flex gap-2">
            <button class="btn btn-primary" onclick="saveSettings()">ğŸ’¾ ä¿å­˜</button>
            <button class="btn btn-outline-secondary" onclick="toggleSettings()">ğŸ”¼ æŠ˜å </button>
        </div>
    </div>

    <!-- ä¸»å†…å®¹ -->
    <div class="container glass-container">
        <h1 class="text-center mb-4 animate__animated animate__fadeIn">æ™ºèƒ½å•è¯ç®¡ç†å™¨ ğŸ“š</h1>

        <!-- ç»Ÿè®¡ä¿¡æ¯ -->
        <div class="row mb-4 text-center">
            <div class="col-md-4 mb-3">
                <div class="card h-100">
                    <div class="card-body">
                        <h5>æ€»å•è¯é‡</h5>
                        <div class="display-4 position-relative">
                            <span id="totalWords">0</span>
                            <span class="word-count-badge">+0</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- åŠŸèƒ½æŒ‰é’® -->
        <div class="text-center mb-4">
            <button class="neon-button animate__animated animate__pulse" onclick="startRecitation()">
                ğŸš€ å¼€å§‹èƒŒè¯µ
            </button>
        </div>

        <!-- è¾“å…¥è¡¨å• -->
        <div class="input-group mb-4">
            <input type="text" id="word-input" class="form-control" placeholder="ğŸ“ è¾“å…¥å•è¯">
            <input type="text" id="meaning-input" class="form-control" placeholder="ğŸ“– è¾“å…¥é‡Šä¹‰">
            <button class="neon-button" onclick="addWord()">â• æ·»åŠ </button>
            <button class="neon-button" onclick="loadFile()">ğŸ“‚ å¯¼å…¥</button>
        </div>

        <!-- æ•°æ®è¡¨æ ¼ -->
        <div class="table-responsive">
            <table class="table table-hover align-middle">
                <thead>
                    <tr>
                        <th style="width: 5%"><input type="checkbox" id="selectAll"></th>
                        <th>å•è¯</th>
                        <th>é‡Šä¹‰</th>
                        <th>æ“ä½œ</th>
                    </tr>
                </thead>
                <tbody id="word-table-body">
                    <!-- åŠ¨æ€å†…å®¹ -->
                </tbody>
            </table>
        </div>

        <!-- åˆ†é¡µæ§ä»¶ -->
        <div class="pagination justify-content-center mt-3">
            <button class="btn btn-secondary" onclick="changePage(-1)">ä¸Šä¸€é¡µ</button>
            <span class="mx-2">ç¬¬ <span id="currentPage">1</span> é¡µ / <span id="totalPages">1</span> é¡µ</span>
            <button class="btn btn-secondary" onclick="changePage(1)">ä¸‹ä¸€é¡µ</button>
        </div>

        <!-- æ‰¹é‡æ“ä½œ -->
        <div class="d-flex justify-content-between mt-4">
            <button class="btn btn-danger" onclick="batchDelete()">ğŸ—‘ï¸ æ‰¹é‡åˆ é™¤</button>
            <button class="btn btn-success" onclick="exportWords()">ğŸ“¤ å¯¼å‡ºCSV</button>
            <button class="btn btn-warning" onclick="clearAllWords()">ğŸš® æ¸…ç©ºå•è¯</button> <!-- æ·»åŠ æ¸…ç©ºå•è¯æŒ‰é’® -->
        </div>
    </div>

    <script>
    // åˆå§‹åŒ–æ•°æ®
    let words = JSON.parse(localStorage.getItem('wordList')) || [];
    let selectedSettings = {
        mode: localStorage.getItem('recitationMode') || '2',
        count: parseInt(localStorage.getItem('recitationCount') || 20)
    };

    // æ¨¡å¼æ˜ å°„
    const modeMap = { 
        '1': 'sequential', 
        '2': 'random', 
        '3': 'hardFirst' 
    };

    // æš—é»‘æ¨¡å¼åˆ‡æ¢
    function toggleDarkMode() {
        document.body.classList.toggle('dark-mode');
        localStorage.setItem('darkMode', document.body.classList.contains('dark-mode'));
    }

    // åˆå§‹åŒ–æš—é»‘æ¨¡å¼
    if (localStorage.getItem('darkMode') === 'true') {
        document.body.classList.add('dark-mode');
    }

    // æ›´æ–°å­˜å‚¨
    function updateStorage() {
        localStorage.setItem('wordList', JSON.stringify(words));
        updateStatistics();
    }

    // æ·»åŠ å•è¯
    function addWord() {
        const word = document.getElementById('word-input').value.trim();
        const meaning = document.getElementById('meaning-input').value.trim();

        if (word && meaning) {
            words.push({ 
                word, 
                meaning,
                practiceCount: 0,
                correctCount: 0
            });
            updateStorage();
            renderTable();
            animateBadge();
            clearInputs();
        } else {
            showToast('âš ï¸ è¯·è¾“å…¥å®Œæ•´çš„å•è¯å’Œé‡Šä¹‰ï¼', 'danger');
        }
    }

    // åˆ†é¡µç›¸å…³å˜é‡
    let currentPage = 1;
    const itemsPerPage = 10;

    // æ¸²æŸ“è¡¨æ ¼
    function renderTable() {
        const tbody = document.getElementById('word-table-body');
        const startIndex = (currentPage - 1) * itemsPerPage;
        const endIndex = startIndex + itemsPerPage;
        const paginatedWords = words.slice(startIndex, endIndex);

        tbody.innerHTML = paginatedWords.map((word, index) => `
        <tr>
            <td><input type="checkbox" class="delete-checkbox" data-index="${startIndex + index}"></td>
            <td class="fw-bold">${word.word}</td>
            <td>${word.meaning}</td>
            <td>
                <button class="btn btn-sm btn-warning" onclick="editWord(${startIndex + index})">âœï¸</button>
                <button class="btn btn-sm btn-danger" onclick="deleteWord(${startIndex + index})">ğŸ—‘ï¸</button>
            </td>
        </tr>
`).join('');

        // æ›´æ–°åˆ†é¡µä¿¡æ¯
        document.getElementById('currentPage').textContent = currentPage;
        document.getElementById('totalPages').textContent = Math.ceil(words.length / itemsPerPage);

        // æ›´æ–°ç»Ÿè®¡ä¿¡æ¯
        document.getElementById('totalWords').textContent = words.length;
    }

    // å¯¼å‡ºCSV
    function exportWords() {
        const csvContent = "data:text/csv;charset=utf-8," 
            + words.map(word => `${word.word},${word.meaning}`).join("\n");
        const link = document.createElement('a');
        link.href = encodeURI(csvContent);
        link.download = 'words.csv';
        link.click();
    }

    // ç»Ÿè®¡åŠ¨ç”»
    function animateBadge() {
        const badge = document.querySelector('.word-count-badge');
        badge.style.transform = 'scale(1.2)';
        badge.textContent = `+${words.length}`;
        setTimeout(() => {
            badge.style.transform = 'scale(1)';
        }, 300);
    }



    // ç¼–è¾‘å•è¯
    function editWord(index) {
        const newWord = prompt('æ–°å•è¯', words[index].word);
        const newMeaning = prompt('æ–°é‡Šä¹‰', words[index].meaning);

        if (newWord && newMeaning) {
            words[index].word = newWord;
            words[index].meaning = newMeaning;
            updateStorage();
            renderTable();
        }
    }

    // æ¸…ç©ºæ‰€æœ‰å•è¯
    function clearAllWords() {
        if (confirm('ç¡®å®šæ¸…ç©ºæ‰€æœ‰å•è¯ï¼Ÿ')) {
            words = [];
            updateStorage();
            renderTable();
            location.reload(); // åˆ·æ–°ç½‘é¡µ
        }
    }

    // åˆ é™¤å•è¯
    function deleteWord(index) {
        if (confirm('ç¡®å®šåˆ é™¤ï¼Ÿ')) {
            words.splice(index, 1);
            updateStorage();
            renderTable();
            location.reload(); // åˆ·æ–°ç½‘é¡µ
        }
    }

    // å¯¼å…¥æ–‡ä»¶
    function loadFile() {
        const inpEle = document.createElement("input");
        inpEle.type = "file";
        inpEle.accept = ".txt";
        inpEle.style.display = "none";

        inpEle.addEventListener("change", function (event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                const content = e.target.result;
                const lines = content.split('\n').filter(line => line.trim());
                const formatErrorLines = [];

                lines.forEach(line => {
                    const parts = line.split(/\s+/);
                    if (parts.length >= 2) {
                        words.push({
                            word: parts[0].trim(),
                            meaning: parts.slice(1).join(' ').trim(),
                            practiceCount: 0,
                            correctCount: 0
                        });
                    } else {
                        formatErrorLines.push(line);
                    }
                });

                updateStorage();
                renderTable();

                if (formatErrorLines.length > 0) {
                    const errorPreview = formatErrorLines.slice(0, 3).join('\n');
                    alert(`æ ¼å¼é”™è¯¯ç¤ºä¾‹ï¼š\n${errorPreview}\n\næ­£ç¡®æ ¼å¼ï¼šå•è¯ é‡Šä¹‰`);
                } else {
                    alert(`æ–‡ä»¶åŠ è½½æˆåŠŸï¼Œå…±å¯¼å…¥ ${lines.length} ä¸ªå•è¯`);
                }
            };
            reader.readAsText(file);
        });

        inpEle.click();
    }

    // å¼€å§‹èƒŒè¯µ
    function startRecitation() {
        if (words.length === 0) {
            alert('è¯·å…ˆæ·»åŠ å•è¯ï¼');
            return;
        }

        // ä¿å­˜å½“å‰å•è¯åˆ—è¡¨å’Œè®¾ç½®
        localStorage.setItem('words', JSON.stringify(words));
        const settings = {
            mode: modeMap[selectedSettings.mode] || 'random',
            count: selectedSettings.count
        };
        localStorage.setItem('reciteSettings', JSON.stringify(settings));
        window.open('recite.html', '_blank', 'width=600,height=800');
    }

    // åˆ†é¡µåˆ‡æ¢
    function changePage(direction) {
        const totalPages = Math.ceil(words.length / itemsPerPage);
        if (direction === -1 && currentPage > 1) {
            currentPage--;
        } else if (direction === 1 && currentPage < totalPages) {
            currentPage++;
        }
        renderTable();
    }

    // æ‰¹é‡åˆ é™¤
    function batchDelete() {
        if (confirm('ç¡®å®šåˆ é™¤é€‰ä¸­çš„å•è¯ï¼Ÿ')) {
            const checkboxes = document.querySelectorAll('.delete-checkbox:checked');
            const indices = Array.from(checkboxes).map(checkbox => checkbox.dataset.index);
            indices.sort((a, b) => b - a);

            indices.forEach(index => {
                words.splice(index, 1);
            });

            updateStorage();
            renderTable();
            location.reload(); // åˆ·æ–°ç½‘é¡µ
        }
    }

    // ä¿å­˜è®¾ç½®
    function saveSettings() {
        selectedSettings.mode = document.getElementById('recitationMode').value;
        selectedSettings.count = parseInt(document.getElementById('recitationCount').value);
        localStorage.setItem('recitationMode', selectedSettings.mode);
        localStorage.setItem('recitationCount', selectedSettings.count);
        alert('è®¾ç½®å·²ä¿å­˜ï¼');
    }

    // åˆ‡æ¢è®¾ç½®é¢æ¿
    function toggleSettings() {
        const panel = document.getElementById('settingsPanel');
        panel.style.display = panel.style.display === 'none' ? 'block' : 'none';
    }

    // åˆå§‹åŒ–æ¸²æŸ“
    renderTable();
    document.getElementById('recitationCount').addEventListener('input', function() {
        document.getElementById('countDisplay').textContent = `${this.value} ä¸ª`;
    });

    // å…¨é€‰åŠŸèƒ½
    document.getElementById('selectAll').addEventListener('change', function() {
        const checkboxes = document.querySelectorAll('.delete-checkbox');
        checkboxes.forEach(checkbox => checkbox.checked = this.checked);
    });
    </script>
</body>
</html>
